<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <h1>哈哈哈哈</h1>
    <script>
download()
        async function download() {
            // const response = await fetch('img.jpeg');
            // const reader = response.body.getReader();

            // while(true) {
            //     const {done, value} = await reader.read();
                
            //     if (done) {
            //         break;
            //     }
            //     console.log(`Received ${value.length} bytes`)

            // }
            let response = await fetch('https://api.github.com/repos/javascript-tutorial/en.javascript.info/commits?per_page=100');

            const reader = response.body.getReader();

            // Step 2：获得总长度（length）
            const contentLength = +response.headers.get('Content-Length');

            // Step 3：读取数据
            let receivedLength = 0; // 当前接收到了这么多字节
            let chunks = []; // 接收到的二进制块的数组（包括 body）
            while(true) {
            const {done, value} = await reader.read();

            if (done) {
                break;
            }

            chunks.push(value);
            receivedLength += value.length;

            console.log(`Received ${receivedLength} of ${contentLength}`)
            }

            // Step 4：将块连接到单个 Uint8Array
            let chunksAll = new Uint8Array(receivedLength); // (4.1)
            let position = 0;
            for(let chunk of chunks) {
                chunksAll.set(chunk, position); // (4.2)
                position += chunk.length;
            }

            // Step 5：解码成字符串
            let result = new TextDecoder("utf-8").decode(chunksAll);

            // 我们完成啦！
            let commits = JSON.parse(result);
            alert(commits[0].author.login)
        }

        
    </script>
</body>

</html>